<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GSMINRES++: sample_std.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">GSMINRES++
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">sample_std.cpp</div></div>
</div><!--header-->
<div class="contents">
<dl class="section author"><dt>Author</dt><dd>Shuntaro Hidaka</dd></dl>
<p>This example solves a set of (standard) shifted linear systems of the form:  </p><p class="formulaDsp">
\[
           (A + \sigma^{(m)} I)x^{(m)} = b, \quad (m=1,\dots,M)
         \]
</p>
<p> where \( I \) is identity matrix. Unlike the generalized shifted linear systems, this version assumes that \( B = I \), so the solver simplifies to the (standard) shifted MINRES method.</p>
<p>Matrices A is given in Matrix Market format (<code>.mtx</code>) and are loaded as packed <code>U</code> Hermitian matrices. The solver uses BLAS routines internally for matrix-vector multiplication (<code>zhpmv</code>).</p>
<p>A key feature of GSMINRES++ is that the user is free to implement matrix-vector multiplications. This example shows one such approach using BLAS, but any other representation or computation method can be used as long as the required computational steps are performed in accordance with the expected algorithmic flow.</p>
<dl class="section user"><dt>Usage:</dt><dd><div class="fragment"><div class="line">$ ./sample_std ../data/A.mtx</div>
</div><!-- fragment --></dd></dl>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;complex&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="gsminres__solver_8hpp.html">gsminres_solver.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="gsminres__util_8hpp.html">gsminres_util.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="gsminres__blas_8hpp.html">gsminres_blas.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="gsminres__lapack_8hpp.html">gsminres_lapack.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a id="a0" name="a0"></a><a class="code hl_function" href="sample1_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) {</div>
<div class="line">  std::size_t N, M;</div>
<div class="line">  <span class="keywordflow">if</span> (argc &lt; 2) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; &lt;MTX_file(A)&gt;&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line">  std::string Aname = argv[1];</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;std::complex&lt;double&gt;&gt; A = <a id="a1" name="a1"></a><a class="code hl_function" href="namespacegsminres_1_1util.html#a425d6034008c64094817344e1d345176">gsminres::util::load_matrix_from_mm</a>(Aname, N);</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;std::complex&lt;double&gt;&gt; b = <a id="a2" name="a2"></a><a class="code hl_function" href="namespacegsminres_1_1util.html#af3ae6854ed69f2142374d1148ff6b457">gsminres::util::generate_ones</a>(N);</div>
<div class="line">  std::vector&lt;std::complex&lt;double&gt;&gt; sigma(10);</div>
<div class="line">  <span class="keywordflow">for</span> (std::size_t m=0; m&lt;10; ++m) {</div>
<div class="line">    std::complex&lt;double&gt; I(0.0, 1.0);</div>
<div class="line">    sigma[m] = 0.01 * std::exp(2 * <a id="a3" name="a3"></a><a class="code hl_define" href="sample2__c_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * I * (m+0.5) / 10.0);</div>
<div class="line">  }</div>
<div class="line">  M = sigma.size();</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;std::complex&lt;double&gt;&gt; x(M*N, {0.0, 0.0});</div>
<div class="line">  std::vector&lt;std::complex&lt;double&gt;&gt; v(N, {0.0, 0.0}), Av(N, {0.0, 0.0});</div>
<div class="line">  std::vector&lt;std::size_t&gt; itr(M);</div>
<div class="line">  std::vector&lt;double&gt; res(M);</div>
<div class="line"> </div>
<div class="line">  <a id="_a4" name="_a4"></a><a class="code hl_class" href="classgsminres_1_1Solver.html">gsminres::Solver</a> solver(N, M);</div>
<div class="line">  <a id="a5" name="a5"></a><a class="code hl_function" href="namespacegsminres_1_1blas.html#a9935ed025609eecae27547d07c0ca404">gsminres::blas::zcopy</a>(N, b, 0, v, 0);</div>
<div class="line">  solver.<a id="a6" name="a6"></a><a class="code hl_function" href="classgsminres_1_1Solver.html#a9278fe3602d86353509a7e85f8d33528">initialize</a>(x, b, v, sigma, 1e-13);</div>
<div class="line">  <span class="keywordflow">for</span> (std::size_t j=0; j&lt;10000; ++j) {</div>
<div class="line">    <a id="a7" name="a7"></a><a class="code hl_function" href="namespacegsminres_1_1blas.html#aa7d10a4ab8e8ce4049d0fe87bd1dd7fd">gsminres::blas::zhpmv</a>({1.0, 0.0}, A, v, {0.0, 0.0}, Av);</div>
<div class="line">    solver.<a id="a8" name="a8"></a><a class="code hl_function" href="classgsminres_1_1Solver.html#a310f96cd880b1b2fe5bb3a481e0ed641">glanczos_pre</a>(Av);</div>
<div class="line">  <a class="code hl_function" href="namespacegsminres_1_1blas.html#a9935ed025609eecae27547d07c0ca404">gsminres::blas::zcopy</a>(N, Av, 0, v, 0);</div>
<div class="line">    solver.<a id="a9" name="a9"></a><a class="code hl_function" href="classgsminres_1_1Solver.html#a54b71962f76b6f6371fcc02c526b1a7f">glanczos_pst</a>(v, Av);</div>
<div class="line">    <span class="keywordflow">if</span> (solver.<a id="a10" name="a10"></a><a class="code hl_function" href="classgsminres_1_1Solver.html#a9ee840487e30608fce0e0550cbdffd84">update</a>(x)) {</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    solver.<a id="a11" name="a11"></a><a class="code hl_function" href="classgsminres_1_1Solver.html#a18a84ddbedfe524ed29bf0f8c58e298f">get_residual</a>(res);</div>
<div class="line">  }</div>
<div class="line">  solver.<a id="a12" name="a12"></a><a class="code hl_function" href="classgsminres_1_1Solver.html#a87d61f56c7ced2a09f7759d98cf6d427">finalize</a>(itr, res);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (std::size_t j=0; j&lt;M; ++j){</div>
<div class="line">    std::vector&lt;std::complex&lt;double&gt;&gt; ans(x.begin()+j*N, x.begin()+(j+1)*N);</div>
<div class="line">    std::vector&lt;std::complex&lt;double&gt;&gt; tmp(N, {0.0, 0.0});</div>
<div class="line">    <span class="keywordtype">double</span> tmp_nrm = 0.0;</div>
<div class="line">    <a class="code hl_function" href="namespacegsminres_1_1blas.html#aa7d10a4ab8e8ce4049d0fe87bd1dd7fd">gsminres::blas::zhpmv</a>({1.0, 0.0},  A, ans, {0.0, 0.0}, tmp);</div>
<div class="line">    <a id="a13" name="a13"></a><a class="code hl_function" href="namespacegsminres_1_1blas.html#af89158adba329c653f70b09df16a3327">gsminres::blas::zaxpy</a>(N,    sigma[j], ans,          0, tmp, 0);</div>
<div class="line">    <a class="code hl_function" href="namespacegsminres_1_1blas.html#af89158adba329c653f70b09df16a3327">gsminres::blas::zaxpy</a>(N, {-1.0, 0.0},   b,          0, tmp, 0);</div>
<div class="line">    tmp_nrm = <a id="a14" name="a14"></a><a class="code hl_function" href="namespacegsminres_1_1blas.html#a8519e852682589ca0cfe3ee597ffb7c7">gsminres::blas::dznrm2</a>(N, tmp);</div>
<div class="line">    std::cout &lt;&lt; std::right</div>
<div class="line">              &lt;&lt; std::setw(2) &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">              &lt;&lt; std::fixed &lt;&lt; std::setw(10) &lt;&lt; std::setprecision(6) &lt;&lt; sigma[j].real() &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">              &lt;&lt; std::fixed &lt;&lt; std::setw(10) &lt;&lt; std::setprecision(6) &lt;&lt; sigma[j].imag() &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">              &lt;&lt; std::setw(5) &lt;&lt; itr[j] &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">              &lt;&lt; std::scientific &lt;&lt; std::setw(12) &lt;&lt; std::setprecision(5) &lt;&lt; res[j] &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">              &lt;&lt; std::scientific &lt;&lt; std::setw(12) &lt;&lt; std::setprecision(5) &lt;&lt; tmp_nrm</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aclassgsminres_1_1Solver_html"><div class="ttname"><a href="classgsminres_1_1Solver.html">gsminres::Solver</a></div><div class="ttdoc">Generalized shifted MINRES solver class.</div><div class="ttdef"><b>Definition</b> gsminres_solver.hpp:31</div></div>
<div class="ttc" id="aclassgsminres_1_1Solver_html_a18a84ddbedfe524ed29bf0f8c58e298f"><div class="ttname"><a href="classgsminres_1_1Solver.html#a18a84ddbedfe524ed29bf0f8c58e298f">gsminres::Solver::get_residual</a></div><div class="ttdeci">void get_residual(std::vector&lt; double &gt; &amp;res) const</div><div class="ttdoc">Retrieve current residual norms in Algorithm.</div><div class="ttdef"><b>Definition</b> gsminres_solver.cpp:133</div></div>
<div class="ttc" id="aclassgsminres_1_1Solver_html_a310f96cd880b1b2fe5bb3a481e0ed641"><div class="ttname"><a href="classgsminres_1_1Solver.html#a310f96cd880b1b2fe5bb3a481e0ed641">gsminres::Solver::glanczos_pre</a></div><div class="ttdeci">void glanczos_pre(std::vector&lt; std::complex&lt; double &gt; &gt; &amp;u)</div><div class="ttdoc">Perform the pre-processing step of the generalized Lanczos process.</div><div class="ttdef"><b>Definition</b> gsminres_solver.cpp:63</div></div>
<div class="ttc" id="aclassgsminres_1_1Solver_html_a54b71962f76b6f6371fcc02c526b1a7f"><div class="ttname"><a href="classgsminres_1_1Solver.html#a54b71962f76b6f6371fcc02c526b1a7f">gsminres::Solver::glanczos_pst</a></div><div class="ttdeci">void glanczos_pst(std::vector&lt; std::complex&lt; double &gt; &gt; &amp;w, std::vector&lt; std::complex&lt; double &gt; &gt; &amp;u)</div><div class="ttdoc">Perform the post-processing step of the generalized Lanczos process.</div><div class="ttdef"><b>Definition</b> gsminres_solver.cpp:69</div></div>
<div class="ttc" id="aclassgsminres_1_1Solver_html_a87d61f56c7ced2a09f7759d98cf6d427"><div class="ttname"><a href="classgsminres_1_1Solver.html#a87d61f56c7ced2a09f7759d98cf6d427">gsminres::Solver::finalize</a></div><div class="ttdeci">void finalize(std::vector&lt; std::size_t &gt; &amp;conv_itr, std::vector&lt; double &gt; &amp;conv_res)</div><div class="ttdoc">Retrieve converged iteration and converged residual norm.</div><div class="ttdef"><b>Definition</b> gsminres_solver.cpp:125</div></div>
<div class="ttc" id="aclassgsminres_1_1Solver_html_a9278fe3602d86353509a7e85f8d33528"><div class="ttname"><a href="classgsminres_1_1Solver.html#a9278fe3602d86353509a7e85f8d33528">gsminres::Solver::initialize</a></div><div class="ttdeci">void initialize(std::vector&lt; std::complex&lt; double &gt; &gt; &amp;x, const std::vector&lt; std::complex&lt; double &gt; &gt; &amp;b, std::vector&lt; std::complex&lt; double &gt; &gt; &amp;w, const std::vector&lt; std::complex&lt; double &gt; &gt; &amp;sigma, const double threshold)</div><div class="ttdoc">Initialize the solver with input data and prepare for iteration.</div><div class="ttdef"><b>Definition</b> gsminres_solver.cpp:46</div></div>
<div class="ttc" id="aclassgsminres_1_1Solver_html_a9ee840487e30608fce0e0550cbdffd84"><div class="ttname"><a href="classgsminres_1_1Solver.html#a9ee840487e30608fce0e0550cbdffd84">gsminres::Solver::update</a></div><div class="ttdeci">bool update(std::vector&lt; std::complex&lt; double &gt; &gt; &amp;x)</div><div class="ttdef"><b>Definition</b> gsminres_solver.cpp:78</div></div>
<div class="ttc" id="agsminres__blas_8hpp_html"><div class="ttname"><a href="gsminres__blas_8hpp.html">gsminres_blas.hpp</a></div><div class="ttdoc">BLAS wrappers for the GSMINRES++ solver.</div></div>
<div class="ttc" id="agsminres__lapack_8hpp_html"><div class="ttname"><a href="gsminres__lapack_8hpp.html">gsminres_lapack.hpp</a></div><div class="ttdoc">LAPACK wrapper functions for the GSMINRES++ solver.</div></div>
<div class="ttc" id="agsminres__solver_8hpp_html"><div class="ttname"><a href="gsminres__solver_8hpp.html">gsminres_solver.hpp</a></div><div class="ttdoc">Header file for the GSMINRES++ solver class.</div></div>
<div class="ttc" id="agsminres__util_8hpp_html"><div class="ttname"><a href="gsminres__util_8hpp.html">gsminres_util.hpp</a></div><div class="ttdoc">Utility functions and data structures for GSMINRES++.</div></div>
<div class="ttc" id="anamespacegsminres_1_1blas_html_a8519e852682589ca0cfe3ee597ffb7c7"><div class="ttname"><a href="namespacegsminres_1_1blas.html#a8519e852682589ca0cfe3ee597ffb7c7">gsminres::blas::dznrm2</a></div><div class="ttdeci">double dznrm2(std::size_t n, const std::vector&lt; std::complex&lt; double &gt; &gt; &amp;x, std::size_t x_offset=0, std::size_t incx=1)</div><div class="ttdoc">Compute the Euclidean norm (2-norm) of a complex vector: .</div><div class="ttdef"><b>Definition</b> gsminres_blas.hpp:171</div></div>
<div class="ttc" id="anamespacegsminres_1_1blas_html_a9935ed025609eecae27547d07c0ca404"><div class="ttname"><a href="namespacegsminres_1_1blas.html#a9935ed025609eecae27547d07c0ca404">gsminres::blas::zcopy</a></div><div class="ttdeci">void zcopy(std::size_t n, const std::vector&lt; std::complex&lt; double &gt; &gt; &amp;x, std::size_t x_offset, std::vector&lt; std::complex&lt; double &gt; &gt; &amp;y, std::size_t y_offset, std::size_t incx=1, std::size_t incy=1)</div><div class="ttdoc">Copy complex vector  into complex vector .</div><div class="ttdef"><b>Definition</b> gsminres_blas.hpp:114</div></div>
<div class="ttc" id="anamespacegsminres_1_1blas_html_aa7d10a4ab8e8ce4049d0fe87bd1dd7fd"><div class="ttname"><a href="namespacegsminres_1_1blas.html#aa7d10a4ab8e8ce4049d0fe87bd1dd7fd">gsminres::blas::zhpmv</a></div><div class="ttdeci">void zhpmv(std::complex&lt; double &gt; alpha, const std::vector&lt; std::complex&lt; double &gt; &gt; &amp;A, const std::vector&lt; std::complex&lt; double &gt; &gt; &amp;x, std::complex&lt; double &gt; beta, std::vector&lt; std::complex&lt; double &gt; &gt; &amp;y)</div><div class="ttdoc">Hermitian packed 'U' matrix-vector multiplication: .</div><div class="ttdef"><b>Definition</b> gsminres_blas.hpp:191</div></div>
<div class="ttc" id="anamespacegsminres_1_1blas_html_af89158adba329c653f70b09df16a3327"><div class="ttname"><a href="namespacegsminres_1_1blas.html#af89158adba329c653f70b09df16a3327">gsminres::blas::zaxpy</a></div><div class="ttdeci">void zaxpy(std::size_t n, std::complex&lt; double &gt; alpha, const std::vector&lt; std::complex&lt; double &gt; &gt; &amp;x, std::size_t x_offset, std::vector&lt; std::complex&lt; double &gt; &gt; &amp;y, std::size_t y_offset, std::size_t incx=1, std::size_t incy=1)</div><div class="ttdoc">Perform  for complex vector.</div><div class="ttdef"><b>Definition</b> gsminres_blas.hpp:134</div></div>
<div class="ttc" id="anamespacegsminres_1_1util_html_a425d6034008c64094817344e1d345176"><div class="ttname"><a href="namespacegsminres_1_1util.html#a425d6034008c64094817344e1d345176">gsminres::util::load_matrix_from_mm</a></div><div class="ttdeci">std::vector&lt; std::complex&lt; double &gt; &gt; load_matrix_from_mm(const std::string &amp;filename, std::size_t &amp;size)</div><div class="ttdoc">Load a packed 'U' Hermitian or symmetric matrix from a Matrix Market file.</div><div class="ttdef"><b>Definition</b> gsminres_util.cpp:19</div></div>
<div class="ttc" id="anamespacegsminres_1_1util_html_af3ae6854ed69f2142374d1148ff6b457"><div class="ttname"><a href="namespacegsminres_1_1util.html#af3ae6854ed69f2142374d1148ff6b457">gsminres::util::generate_ones</a></div><div class="ttdeci">std::vector&lt; std::complex&lt; double &gt; &gt; generate_ones(const std::size_t size)</div><div class="ttdoc">Generate a vector filled with ones.</div><div class="ttdef"><b>Definition</b> gsminres_util.cpp:122</div></div>
<div class="ttc" id="asample1_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="sample1_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition</b> sample1.cpp:41</div></div>
<div class="ttc" id="asample2__c_8c_html_ae71449b1cc6e6250b91f539153a7a0d3"><div class="ttname"><a href="sample2__c_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a></div><div class="ttdeci">#define M_PI</div><div class="ttdef"><b>Definition</b> sample2_c.c:39</div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
